{% extends 'medical/base.html' %}
{% load static %}

{% block title %}Param√®tres - H√¥pital EL GHASSANI{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-cog me-2"></i>
                    {% if user_role == 'technician' %}Param√®tres Syst√®me - Technicien
                    {% else %}Param√®tres de la Plateforme{% endif %}
                </h6>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Section sp√©ciale pour Technicien -->
                    {% if user_role == 'technician' %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="alert alert-info">
                                <h5><i class="fas fa-info-circle me-2"></i>Acc√®s Technicien</h5>
                                <p class="mb-0">En tant que technicien, vous avez acc√®s aux param√®tres syst√®me pour la maintenance et la configuration de la plateforme.</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Informations g√©n√©rales -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-hospital me-2"></i>Informations G√©n√©rales
                            </h5>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Nom de l'h√¥pital</label>
                                <input type="text" class="form-control" name="hospital_name" value="H√¥pital EL GHASSANI">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="hospital_email" value="contact@elghassani.ma">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">T√©l√©phone</label>
                                <input type="tel" class="form-control" name="hospital_phone" value="+212 5 35 12 34 56">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Adresse</label>
                                <input type="text" class="form-control" name="hospital_address" value="F√®s, Maroc">
                            </div>
                        </div>
                    </div>

                    <!-- Configuration de l'application -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-cogs me-2"></i>Configuration de l'Application
                            </h5>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Langue par d√©faut</label>
                                <select class="form-select" name="default_language" id="language-select">
                                    <option value="fr" selected>üá´üá∑ Fran√ßais</option>
                                    <option value="ar">üá≤üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                                </select>
                                <small class="text-muted">La langue sera appliqu√©e √† l'interface</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Th√®me</label>
                                <select class="form-select" name="theme" id="theme-select">
                                    <option value="light">‚òÄÔ∏è Clair</option>
                                    <option value="dark">üåô Sombre</option>
                                    <option value="auto" selected>‚öôÔ∏è Automatique</option>
                                </select>
                                <small class="text-muted">Th√®me d'affichage de l'interface</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Format de date</label>
                                <select class="form-select" name="date_format">
                                    <option value="dd/mm/yyyy" selected>DD/MM/YYYY (31/12/2025)</option>
                                    <option value="mm/dd/yyyy">MM/DD/YYYY (12/31/2025)</option>
                                    <option value="yyyy-mm-dd">YYYY-MM-DD (2025-12-31)</option>
                                    <option value="dd-mm-yyyy">DD-MM-YYYY (31-12-2025)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Format d'heure</label>
                                <select class="form-select" name="time_format">
                                    <option value="24h" selected>Format 24h (14:30)</option>
                                    <option value="12h">Format 12h (2:30 PM)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Fuseau horaire</label>
                                <select class="form-select" name="timezone">
                                    <option value="Africa/Casablanca" selected>üá≤üá¶ Casablanca (GMT+1)</option>
                                    <option value="Europe/Paris">üá´üá∑ Paris (GMT+1)</option>
                                    <option value="America/New_York">üá∫üá∏ New York (GMT-5)</option>
                                    <option value="Europe/London">üá¨üáß London (GMT+0)</option>
                                    <option value="Asia/Dubai">üá¶üá™ Dubai (GMT+4)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Devise par d√©faut</label>
                                <select class="form-select" name="currency">
                                    <option value="MAD" selected>üá≤üá¶ Dirham Marocain (MAD)</option>
                                    <option value="EUR">üá™üá∫ Euro (EUR)</option>
                                    <option value="USD">üá∫üá∏ Dollar US (USD)</option>
                                    <option value="GBP">üá¨üáß Livre Sterling (GBP)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Taille maximale des fichiers (MB)</label>
                                <input type="number" class="form-control" name="max_file_size" value="10" min="1" max="100">
                                <small class="text-muted">Taille maximale pour les uploads</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Types de fichiers autoris√©s</label>
                                <input type="text" class="form-control" name="allowed_file_types" value="pdf,jpg,jpeg,png,doc,docx,xlsx">
                                <small class="text-muted">Extensions s√©par√©es par des virgules</small>
                            </div>
                        </div>
                    </div>

                    <!-- Interface utilisateur -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-desktop me-2"></i>Interface Utilisateur
                            </h5>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Nombre d'√©l√©ments par page</label>
                                <select class="form-select" name="items_per_page">
                                    <option value="10">10 √©l√©ments</option>
                                    <option value="25" selected>25 √©l√©ments</option>
                                    <option value="50">50 √©l√©ments</option>
                                    <option value="100">100 √©l√©ments</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Densit√© d'affichage</label>
                                <select class="form-select" name="display_density">
                                    <option value="compact">Compact</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="comfortable">Confortable</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Animation des transitions</label>
                                <select class="form-select" name="animations">
                                    <option value="fast">Rapide</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="slow">Lent</option>
                                    <option value="disabled">D√©sactiv√©</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Taille de police</label>
                                <select class="form-select" name="font_size">
                                    <option value="small">Petite</option>
                                    <option value="medium" selected>Moyenne</option>
                                    <option value="large">Grande</option>
                                    <option value="extra-large">Tr√®s grande</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="sidebar_collapsed" id="sidebar_collapsed">
                                <label class="form-check-label" for="sidebar_collapsed">
                                    Sidebar r√©duite par d√©faut
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="breadcrumbs_enabled" checked id="breadcrumbs_enabled">
                                <label class="form-check-label" for="breadcrumbs_enabled">
                                    Fil d'Ariane activ√©
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-bell me-2"></i>Notifications
                            </h5>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="email_notifications" checked id="email_notifications">
                                <label class="form-check-label" for="email_notifications">
                                    <i class="fas fa-envelope me-1"></i>Notifications par email
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="sms_notifications" id="sms_notifications">
                                <label class="form-check-label" for="sms_notifications">
                                    <i class="fas fa-sms me-1"></i>Notifications par SMS
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="notification_sound" checked id="notification_sound">
                                <label class="form-check-label" for="notification_sound">
                                    <i class="fas fa-volume-up me-1"></i>Son des notifications
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Types de notifications</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="notif_patients" checked id="notif_patients">
                                    <label class="form-check-label" for="notif_patients">
                                        Nouveaux patients
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="notif_reports" checked id="notif_reports">
                                    <label class="form-check-label" for="notif_reports">
                                        Nouveaux rapports
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="notif_appointments" id="notif_appointments">
                                    <label class="form-check-label" for="notif_appointments">
                                        Rendez-vous
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="notif_urgent" checked id="notif_urgent">
                                    <label class="form-check-label" for="notif_urgent">
                                        Cas urgents
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Fr√©quence des rappels</label>
                                <select class="form-select" name="reminder_frequency">
                                    <option value="immediate">Imm√©diat</option>
                                    <option value="5min">5 minutes</option>
                                    <option value="15min" selected>15 minutes</option>
                                    <option value="30min">30 minutes</option>
                                    <option value="1hour">1 heure</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Communication -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-comments me-2"></i>Communication
                            </h5>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Serveur SMTP</label>
                                <input type="text" class="form-control" name="smtp_server" value="smtp.gmail.com" placeholder="smtp.gmail.com">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Port SMTP</label>
                                <input type="number" class="form-control" name="smtp_port" value="587" placeholder="587">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email d'envoi</label>
                                <input type="email" class="form-control" name="sender_email" value="noreply@elghassani.ma">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Nom d'exp√©diteur</label>
                                <input type="text" class="form-control" name="sender_name" value="H√¥pital EL GHASSANI">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="smtp_ssl" checked id="smtp_ssl">
                                <label class="form-check-label" for="smtp_ssl">
                                    Utiliser SSL/TLS
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Fournisseur SMS</label>
                                <select class="form-select" name="sms_provider">
                                    <option value="twilio">Twilio</option>
                                    <option value="nexmo">Vonage (Nexmo)</option>
                                    <option value="custom">Personnalis√©</option>
                                    <option value="none" selected>Aucun</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Int√©grations -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-plug me-2"></i>Int√©grations
                            </h5>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="google_analytics" id="google_analytics">
                                <label class="form-check-label" for="google_analytics">
                                    <i class="fab fa-google me-1"></i>Google Analytics
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="facebook_pixel" id="facebook_pixel">
                                <label class="form-check-label" for="facebook_pixel">
                                    <i class="fab fa-facebook me-1"></i>Facebook Pixel
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Cl√© API Google Maps</label>
                                <input type="text" class="form-control" name="google_maps_key" placeholder="AIzaSy...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Token d'acc√®s API</label>
                                <input type="password" class="form-control" name="api_token" placeholder="Token d'API">
                            </div>
                        </div>
                    </div>

                    <!-- S√©curit√© -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-shield-alt me-2"></i>S√©curit√©
                            </h5>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">D√©lai d'expiration de session (heures)</label>
                                <input type="number" class="form-control" name="session_timeout" value="1">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Tentatives de connexion max</label>
                                <input type="number" class="form-control" name="max_login_attempts" value="5">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Longueur min du mot de passe</label>
                                <input type="number" class="form-control" name="password_min_length" value="8">
                            </div>
                        </div>
                    </div>

                    <!-- Sauvegarde -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-database me-2"></i>Sauvegarde
                            </h5>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Fr√©quence de sauvegarde</label>
                                <select class="form-select" name="backup_frequency">
                                    <option value="hourly">Horaire</option>
                                    <option value="daily" selected>Quotidien</option>
                                    <option value="weekly">Hebdomadaire</option>
                                    <option value="monthly">Mensuel</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">R√©tention des sauvegardes (jours)</label>
                                <input type="number" class="form-control" name="backup_retention_days" value="30">
                            </div>
                        </div>
                    </div>

                    <!-- Mode maintenance -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-tools me-2"></i>Maintenance
                            </h5>
                        </div>
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="maintenance_mode">
                                <label class="form-check-label text-warning">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    Mode maintenance (d√©sactive l'acc√®s public)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="row">
                        <div class="col-12 text-end">
                            <button type="button" class="btn btn-secondary me-2" onclick="resetSettings()">
                                <i class="fas fa-undo me-2"></i>R√©initialiser
                            </button>
                            <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save me-2"></i>Sauvegarder
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Fonction pour r√©initialiser les param√®tres
function resetSettings() {
    if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser tous les param√®tres ?')) {
        location.reload();
    }
}

// Fonction pour changer le th√®me en temps r√©el
function changeTheme(theme) {
    const body = document.body;
    const html = document.documentElement;
    
    // Supprimer les classes de th√®me existantes
    body.classList.remove('light-theme', 'dark-theme');
    html.classList.remove('light-theme', 'dark-theme');
    
    // Appliquer le nouveau th√®me
    if (theme === 'dark') {
        body.classList.add('dark-theme');
        html.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
    } else if (theme === 'light') {
        body.classList.add('light-theme');
        html.classList.add('light-theme');
        localStorage.setItem('theme', 'light');
    } else if (theme === 'auto') {
        // Mode automatique bas√© sur les pr√©f√©rences syst√®me
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            body.classList.add('dark-theme');
            html.classList.add('dark-theme');
        } else {
            body.classList.add('light-theme');
            html.classList.add('light-theme');
        }
        localStorage.setItem('theme', 'auto');
    }
    
    // Mettre √† jour l'ic√¥ne du bouton de th√®me dans la navbar si elle existe
    updateThemeIcon(theme);
}

// Fonction pour mettre √† jour l'ic√¥ne du th√®me
function updateThemeIcon(theme) {
    const themeIcon = document.getElementById('theme-icon');
    if (themeIcon) {
        if (theme === 'dark') {
            themeIcon.className = 'fas fa-moon';
        } else if (theme === 'light') {
            themeIcon.className = 'fas fa-sun';
        } else {
            themeIcon.className = 'fas fa-adjust';
        }
    }
}

// √âcouter les changements du s√©lecteur de th√®me
document.addEventListener('DOMContentLoaded', function() {
    const themeSelect = document.querySelector('select[name="theme"]');
    if (themeSelect) {
        // Charger le th√®me sauvegard√©
        const savedTheme = localStorage.getItem('theme') || 'light';
        themeSelect.value = savedTheme;
        changeTheme(savedTheme);
        
        // √âcouter les changements
        themeSelect.addEventListener('change', function() {
            changeTheme(this.value);
        });
    }
    
    // Charger les param√®tres sauvegard√©s
    loadSettings();
    
    // √âcouter les changements de pr√©f√©rences syst√®me pour le mode auto
    if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'auto') {
                changeTheme('auto');
            }
        });
    }
    
    // √âcouter les changements de langue
    const languageSelect = document.getElementById('language-select');
    if (languageSelect) {
        languageSelect.addEventListener('change', function() {
            applyLanguage(this.value);
            showNotification(`Langue chang√©e vers ${this.options[this.selectedIndex].text}`, 'info');
        });
    }
    
    // √âcouter les changements de taille de police
    const fontSizeSelect = document.querySelector('select[name="font_size"]');
    if (fontSizeSelect) {
        fontSizeSelect.addEventListener('change', function() {
            applyFontSize(this.value);
        });
    }
    
    // √âcouter les changements de densit√© d'affichage
    const densitySelect = document.querySelector('select[name="display_density"]');
    if (densitySelect) {
        densitySelect.addEventListener('change', function() {
            applyDisplayDensity(this.value);
        });
    }
    
    // √âcouter les changements d'animations
    const animationsSelect = document.querySelector('select[name="animations"]');
    if (animationsSelect) {
        animationsSelect.addEventListener('change', function() {
            applyAnimations(this.value);
        });
    }
});

// Fonction pour sauvegarder les param√®tres
function saveSettings() {
    const form = document.querySelector('form');
    const formData = new FormData(form);
    
    // Cr√©er un objet pour stocker tous les param√®tres
    const settings = {};
    
    // Collecter tous les param√®tres
    for (let [key, value] of formData.entries()) {
        settings[key] = value;
    }
    
    // Sauvegarder dans localStorage
    localStorage.setItem('app_settings', JSON.stringify(settings));
    
    // Appliquer les param√®tres imm√©diatement
    applySettings(settings);
    
    // Afficher un message de succ√®s
    showNotification('Param√®tres sauvegard√©s avec succ√®s!', 'success');
    
    console.log('Param√®tres sauvegard√©s:', settings);
}

// Fonction pour appliquer les param√®tres
function applySettings(settings) {
    // Appliquer le th√®me
    if (settings.theme) {
        changeTheme(settings.theme);
    }
    
    // Appliquer la langue
    if (settings.default_language) {
        applyLanguage(settings.default_language);
    }
    
    // Appliquer la taille de police
    if (settings.font_size) {
        applyFontSize(settings.font_size);
    }
    
    // Appliquer la densit√© d'affichage
    if (settings.display_density) {
        applyDisplayDensity(settings.display_density);
    }
    
    // Appliquer les animations
    if (settings.animations) {
        applyAnimations(settings.animations);
    }
}

// Fonction pour appliquer la langue
function applyLanguage(language) {
    console.log('Langue chang√©e vers:', language);
    
    const body = document.body;
    const html = document.documentElement;
    
    // Supprimer les classes de langue pr√©c√©dentes
    body.classList.remove('lang-fr', 'lang-ar', 'rtl');
    html.classList.remove('lang-fr', 'lang-ar', 'rtl');
    
    // Ajouter la nouvelle classe de langue
    body.classList.add(`lang-${language}`);
    html.classList.add(`lang-${language}`);
    
    // Appliquer RTL pour l'arabe
    if (language === 'ar') {
        body.classList.add('rtl');
        html.classList.add('rtl');
        html.setAttribute('dir', 'rtl');
        html.setAttribute('lang', 'ar');
    } else {
        html.setAttribute('dir', 'ltr');
        html.setAttribute('lang', 'fr');
    }
    
    // Traductions
    const translations = {
        'fr': {
            'dashboard': 'Tableau de bord',
            'patients': 'Patients',
            'reports': 'Rapports',
            'documents': 'Documents',
            'users': 'Utilisateurs',
            'settings': 'Param√®tres',
            'profile': 'Profil',
            'logout': 'D√©connexion'
        },
        'ar': {
            'dashboard': 'ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ',
            'patients': 'ÿßŸÑŸÖÿ±ÿ∂Ÿâ',
            'reports': 'ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
            'documents': 'ÿßŸÑŸàÿ´ÿßÿ¶ŸÇ',
            'users': 'ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ',
            'settings': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
            'profile': 'ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä',
            'logout': 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨'
        }
    };
    
    // Appliquer les traductions si disponibles
    if (translations[language]) {
        applyTranslations(translations[language]);
        console.log('Traductions appliqu√©es pour:', language);
    }
}

// Fonction pour appliquer les traductions
function applyTranslations(translations) {
    // Traduire les √©l√©ments de navigation
    const elements = {
        'dashboard': document.querySelector('a[href*="dashboard"]'),
        'patients': document.querySelector('a[href*="patients"]'),
        'reports': document.querySelector('a[href*="reports"]'),
        'documents': document.querySelector('a[href*="documents"]'),
        'users': document.querySelector('a[href*="users"]'),
        'settings': document.querySelector('a[href*="settings"]'),
        'profile': document.querySelector('a[href*="profile"]'),
        'logout': document.querySelector('a[href*="logout"]')
    };
    
    for (const [key, element] of Object.entries(elements)) {
        if (element && translations[key]) {
            element.textContent = translations[key];
        }
    }
}

// Fonction pour appliquer la taille de police
function applyFontSize(fontSize) {
    const sizes = {
        'small': '14px',
        'medium': '16px',
        'large': '18px',
        'extra-large': '20px'
    };
    
    if (sizes[fontSize]) {
        document.documentElement.style.fontSize = sizes[fontSize];
        localStorage.setItem('font_size', fontSize);
    }
}

// Fonction pour appliquer la densit√© d'affichage
function applyDisplayDensity(density) {
    const densities = {
        'compact': '0.8rem',
        'normal': '1rem',
        'comfortable': '1.2rem'
    };
    
    if (densities[density]) {
        document.documentElement.style.setProperty('--spacing', densities[density]);
        localStorage.setItem('display_density', density);
    }
}

// Fonction pour appliquer les animations
function applyAnimations(animations) {
    const durations = {
        'fast': '0.1s',
        'normal': '0.3s',
        'slow': '0.5s',
        'disabled': '0s'
    };
    
    if (durations[animations]) {
        document.documentElement.style.setProperty('--transition-duration', durations[animations]);
        localStorage.setItem('animations', animations);
    }
}

// Fonction pour afficher une notification
function showNotification(message, type = 'info') {
    // Cr√©er l'√©l√©ment de notification
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // Ajouter √† la page
    document.body.appendChild(notification);
    
    // Supprimer automatiquement apr√®s 5 secondes
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
}

// Fonction pour charger les param√®tres sauvegard√©s
function loadSettings() {
    const savedSettings = localStorage.getItem('app_settings');
    if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        
        // Remplir le formulaire avec les valeurs sauvegard√©es
        Object.keys(settings).forEach(key => {
            const element = document.querySelector(`[name="${key}"]`);
            if (element) {
                if (element.type === 'checkbox') {
                    element.checked = settings[key] === 'on' || settings[key] === true;
                } else {
                    element.value = settings[key];
                }
            }
        });
        
        // Appliquer les param√®tres
        applySettings(settings);
    }
}
</script>

<!-- CSS pour les th√®mes -->
<style>
/* Th√®me clair (par d√©faut) */
.light-theme {
    --bg-color: #ffffff;
    --text-color: #333333;
    --card-bg: #ffffff;
    --border-color: #dee2e6;
    --primary-color: #007bff;
    --secondary-color: #6c757d;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --info-color: #17a2b8;
}

/* Th√®me sombre */
.dark-theme {
    --bg-color: #1a1a1a;
    --text-color: #ffffff;
    --card-bg: #2d2d2d;
    --border-color: #404040;
    --primary-color: #0d6efd;
    --secondary-color: #6c757d;
    --success-color: #198754;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --info-color: #0dcaf0;
}

/* Application des variables CSS */
body {
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background-color 0.3s ease, color 0.3s ease;
}

.card {
    background-color: var(--card-bg);
    border: none;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
}

.card:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
}

.card-header {
    background-color: transparent;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 16px 16px 0 0 !important;
}

.dark-theme .card-header {
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.text-primary {
    color: var(--primary-color) !important;
}

.btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-primary:hover {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    opacity: 0.9;
}

.form-control, .form-select {
    background-color: var(--card-bg);
    color: var(--text-color);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    background-color: var(--card-bg);
    color: var(--text-color);
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
    outline: none;
}

.dark-theme .form-control, .dark-theme .form-select {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.dark-theme .form-control:focus, .dark-theme .form-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.2);
}

.navbar {
    background-color: var(--card-bg) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.sidebar {
    background-color: var(--card-bg) !important;
    border-right: 1px solid rgba(0, 0, 0, 0.05);
}

.dark-theme .navbar {
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.dark-theme .sidebar {
    border-right: 1px solid rgba(255, 255, 255, 0.05);
}

.dropdown-menu {
    background-color: var(--card-bg);
    border: none;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.dropdown-item {
    color: var(--text-color);
    border-radius: 8px;
    margin: 2px 8px;
    transition: all 0.2s ease;
}

.dropdown-item:hover {
    background-color: var(--primary-color);
    color: white;
    transform: translateX(4px);
}

.alert {
    background-color: var(--card-bg);
    border: none;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.table {
    color: var(--text-color);
    border-radius: 8px;
    overflow: hidden;
}

.table-striped > tbody > tr:nth-of-type(odd) > td {
    background-color: rgba(0, 0, 0, 0.02);
}

.dark-theme .table-striped > tbody > tr:nth-of-type(odd) > td {
    background-color: rgba(255, 255, 255, 0.02);
}

/* Animation de transition */
* {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
}

/* Styles pour les nouvelles fonctionnalit√©s */
.form-section {
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    border: none;
    background: rgba(0, 123, 255, 0.03);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.form-section h3 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    font-size: 1.2rem;
    font-weight: 600;
    border-bottom: 1px solid rgba(0, 123, 255, 0.1);
    padding-bottom: 0.5rem;
}

.form-label {
    font-weight: 500;
    color: var(--text-color);
    margin-bottom: 0.5rem;
}

.text-muted {
    color: var(--secondary-color) !important;
    opacity: 0.8;
}

.form-check-label {
    color: var(--text-color);
}

/* Styles pour les notifications */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    min-width: 300px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: 8px;
}

/* Styles pour les ic√¥nes de langue */
.language-flag {
    font-size: 1.2em;
    margin-right: 0.5rem;
}

/* Styles pour les switchs */
.form-check-input:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

/* Styles pour les s√©lecteurs */
.form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23666' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 16px 12px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
}

.dark-theme .form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ccc' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
}

/* Suppression compl√®te des artefacts visuels */
.form-select {
    outline: none !important;
    box-shadow: none !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
}

.form-select:focus {
    outline: none !important;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15) !important;
    border-color: var(--primary-color) !important;
}

.form-select:active {
    outline: none !important;
    box-shadow: none !important;
}

.form-select:focus-visible {
    outline: none !important;
}

/* Suppression des pseudo-√©l√©ments qui peuvent causer des artefacts */
.form-select::before,
.form-select::after {
    display: none !important;
    content: none !important;
}

/* Suppression des bordures et ombres par d√©faut */
.form-select,
.form-select:focus,
.form-select:active,
.form-select:hover {
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    box-shadow: none !important;
    outline: none !important;
}

.form-select:focus {
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15) !important;
}

/* Th√®me sombre */
.dark-theme .form-select,
.dark-theme .form-select:focus,
.dark-theme .form-select:active,
.dark-theme .form-select:hover {
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: none !important;
    outline: none !important;
}

.dark-theme .form-select:focus {
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.2) !important;
}

/* Responsive */
@media (max-width: 768px) {
    .form-section {
        padding: 1rem;
    }
    
    .notification {
        left: 10px;
        right: 10px;
        min-width: auto;
    }
}
</style>
{% endblock %}
